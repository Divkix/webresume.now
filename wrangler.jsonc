{
	// Custom worker wraps OpenNext handler + adds queue consumer
	"main": "worker.ts",
	"name": "clickfolio-me",
	"compatibility_date": "2026-01-22",
	// Explicitly enable workers.dev subdomain (set to false if using custom domain only)
	"workers_dev": true,
	// Disable preview URLs to avoid confusion
	"preview_urls": false,
	// Custom domains (kept in config so CI deploy doesn't remove them)
	"routes": [
		{
			"pattern": "clickfolio.me",
			"zone_name": "clickfolio.me",
			"custom_domain": true
		},
		{
			"pattern": "www.clickfolio.me",
			"zone_name": "clickfolio.me",
			"custom_domain": true
		}
	],
	// Minify to reduce bundle size (saves ~400KB gzipped)
	"minify": true,
	// Aliases to stub out dead code from the worker bundle (esbuild level).
	// These run AFTER Next.js build, at wrangler's esbuild bundling step.
	"alias": {
		// @vercel/og — doesn't work on CF Workers, but Next.js bundles it into its dist.
		// Saves ~2 MB (704 KB JS + 1.3 MB resvg.wasm + 87 KB yoga.wasm).
		"next/dist/compiled/@vercel/og/index.edge.js": "./stubs/og-stub.js",
		// @zxcvbn-ts — password dictionaries (1.73 MB). Only used client-side in
		// PasswordInput.tsx, but Next.js SSRs client components into the server bundle.
		// On the worker, password strength is a no-op (server validates length only).
		"@zxcvbn-ts/core": "./lib/stubs/zxcvbn-core-stub.mjs",
		"@zxcvbn-ts/language-common": "./lib/stubs/zxcvbn-lang-stub.mjs",
		"@zxcvbn-ts/language-en": "./lib/stubs/zxcvbn-lang-stub.mjs",
		// zod/v3 — Zod v4 ships v3 compat layer (128 KB). Only @ai-sdk/provider-utils
		// imports it for a dead code path (guarded by isZod4Schema runtime check).
		"zod/v3": "./lib/stubs/zod-v3-stub.mjs"
	},
	"compatibility_flags": [
		// Enable Node.js API
		// see https://developers.cloudflare.com/workers/configuration/compatibility-flags/#nodejs-compatibility-flag
		"nodejs_compat",
		// Allow to fetch URLs in your app
		// see https://developers.cloudflare.com/workers/configuration/compatibility-flags/#global-fetch-strictly-public
		"global_fetch_strictly_public"
	],
	"assets": {
		"directory": ".open-next/assets",
		"binding": "ASSETS"
	},
	"placement": {
		"mode": "smart"
	},
	// D1 Database binding
	"d1_databases": [
		{
			"binding": "DB",
			"database_name": "clickfolio-db",
			"database_id": "37cf1935-96c5-40c8-aa2e-0d0655f9b652"
		}
	],
	// R2 bucket binding for direct access (replaces AWS SDK for most operations)
	"r2_buckets": [
		{
			"binding": "R2_BUCKET",
			"bucket_name": "clickfolio-bucket"
		}
	],
	// Cloudflare Queues for async processing
	"queues": {
		"producers": [
			{ "binding": "RESUME_PARSE_QUEUE", "queue": "resume-parse-queue" }
		],
		"consumers": [
			{
				"queue": "resume-parse-queue",
				"max_batch_size": 1,
				"max_retries": 3,
				"dead_letter_queue": "resume-parse-dlq"
			},
			{
				"queue": "resume-parse-dlq",
				"max_batch_size": 1,
				"max_retries": 0
			}
		]
	},
	// Durable Objects for real-time WebSocket notifications
	"durable_objects": {
		"bindings": [
			{ "name": "RESUME_STATUS_DO", "class_name": "ResumeStatusDO" }
		]
	},
	"migrations": [
		{ "tag": "v1", "new_sqlite_classes": ["DOShardedTagCache"] },
		{ "tag": "v2", "deleted_classes": ["DOShardedTagCache"], "new_classes": ["ResumeStatusDO"] }
	],
	"observability": {
		"enabled": true,
		"head_sampling_rate": 0.1,
		"logs": {
			"enabled": true,
			"head_sampling_rate": 0.1,
			"persist": true,
			"invocation_logs": true
		}
	},
	// Cron Triggers for scheduled tasks
	"triggers": {
		"crons": [
			"0 3 * * *",     // Daily at 3 AM UTC - runs /api/cron/cleanup
			"*/15 * * * *"   // Every 15 minutes - runs /api/cron/recover-orphaned
		]
	},
	"vars": {
		// Environment variables are set via 'wrangler secret put' for production
		// and in .env.local for local development (Next.js loads these automatically)
		//
		// ===== REQUIRED SECRETS =====
		//   wrangler secret put BETTER_AUTH_SECRET
		//   wrangler secret put BETTER_AUTH_URL                      # Also used as app URL
		//   wrangler secret put GOOGLE_CLIENT_ID
		//   wrangler secret put GOOGLE_CLIENT_SECRET
			//
		// ===== OPTIONAL: Edge cache purge (only for custom domains behind CF proxy) =====
		//   wrangler secret put CF_ZONE_ID                  # From Cloudflare Dashboard
		//   wrangler secret put CF_CACHE_PURGE_API_TOKEN    # API token with Cache Purge permission
		//
		// ===== OPTIONAL: Email (password reset) =====
		//   wrangler secret put RESEND_API_KEY      # From resend.com (free tier: 3k/month)
		//
		// ===== OPTIONAL: DLQ alerting (defaults to Cloudflare Logpush) =====
		//   wrangler secret put ALERT_CHANNEL       # logpush | webhook | email
		//   wrangler secret put ALERT_WEBHOOK_URL   # Slack/Discord webhook URL
		//
		// ===== ANALYTICS (Umami) =====
		//   wrangler secret put NEXT_PUBLIC_UMAMI_WEBSITE_ID
		//   wrangler secret put UMAMI_API_URL
		//   wrangler secret put UMAMI_USERNAME
		//   wrangler secret put UMAMI_PASSWORD
		//
		// ===== AI PROVIDER (resume parsing) =====
		// Cloudflare AI Gateway (proxies to OpenRouter)
		//   wrangler secret put CF_AI_GATEWAY_ACCOUNT_ID
		//   wrangler secret put CF_AI_GATEWAY_ID
		//   wrangler secret put CF_AIG_AUTH_TOKEN
		//
		// Note: R2 is accessed via binding (R2_BUCKET) - no API credentials needed
		// Optional: For edge cache purge (set via wrangler secret put in production)
		"CF_ZONE_ID": "67b153979964d5eafc441643acb1fc14",
		"NODE_ENV": "production",
		"AI_MODEL": "openai/gpt-oss-120b:nitro"
	}
}
